L.Control.Sidebar=L.Control.extend({includes:L.Mixin.Events,options:{closeButton:!0,position:"left",autoPan:!0},initialize:function(a,b){L.setOptions(this,b);var c=this._contentContainer=L.DomUtil.get(a);c.parentNode.removeChild(c);var d="leaflet-",e=this._container=L.DomUtil.create("div",d+"sidebar "+this.options.position);if(L.DomUtil.addClass(c,d+"control"),e.appendChild(c),this.options.closeButton){var f=this._closeButton=L.DomUtil.create("a","close",e);f.innerHTML="&times;"}},addTo:function(a){var b=this._container,c=this._contentContainer;if(this.options.closeButton){var d=this._closeButton;L.DomEvent.on(d,"click",this.hide,this)}L.DomEvent.on(b,"transitionend",this._handleTransitionEvent,this).on(b,"webkitTransitionEnd",this._handleTransitionEvent,this);var e=a._controlContainer;e.insertBefore(b,e.firstChild),this._map=a;var f=L.DomEvent.stopPropagation,g=L.DomEvent._fakeStop||f;return L.DomEvent.on(c,"contextmenu",f).on(c,"click",g).on(c,"mousedown",f).on(c,"touchstart",f).on(c,"dblclick",g).on(c,"mousewheel",f).on(c,"MozMousePixelScroll",f),this},removeFrom:function(a){this.hide();var b=this._container,c=this._contentContainer,d=a._controlContainer;d.removeChild(b),this._map=null;var e=L.DomEvent.stopPropagation,f=L.DomEvent._fakeStop||e;if(L.DomEvent.off(c,"contextmenu",e).off(c,"click",f).off(c,"mousedown",e).off(c,"touchstart",e).off(c,"dblclick",f).off(c,"mousewheel",e).off(c,"MozMousePixelScroll",e),L.DomEvent.off(b,"transitionend",this._handleTransitionEvent,this).off(b,"webkitTransitionEnd",this._handleTransitionEvent,this),this._closeButton&&this._close){var g=this._closeButton;L.DomEvent.off(g,"click",this.hide,this)}return this},isVisible:function(){return L.DomUtil.hasClass(this._container,"visible")},show:function(){this.isVisible()||(L.DomUtil.addClass(this._container,"visible"),this.options.autoPan&&this._map.panBy([-this.getOffset()/2,0],{duration:.5}),this.fire("show"))},hide:function(a){this.isVisible()&&(L.DomUtil.removeClass(this._container,"visible"),this.options.autoPan&&this._map.panBy([this.getOffset()/2,0],{duration:.5}),this.fire("hide")),a&&L.DomEvent.stopPropagation(a)},toggle:function(){this.isVisible()?this.hide():this.show()},getContainer:function(){return this._contentContainer},getCloseButton:function(){return this._closeButton},setContent:function(a){var b=this.getContainer();if("string"==typeof a)b.innerHTML=a;else{for(;b.firstChild;)b.removeChild(b.firstChild);b.appendChild(a)}return this},getOffset:function(){return"right"===this.options.position?-this._container.offsetWidth:this._container.offsetWidth},_handleTransitionEvent:function(a){("left"==a.propertyName||"right"==a.propertyName)&&this.fire(this.isVisible()?"shown":"hidden")}}),L.control.sidebar=function(a,b){return new L.Control.Sidebar(a,b)},L.Control.Button=L.Control.extend({includes:L.Mixin.Events,options:{position:"topright"},initialize:function(a,b){L.setOptions(this,b);var c=null;if(a instanceof HTMLElement){c=a;try{c.parentNode.removeChild(c)}catch(a){}}else{if("string"!=typeof a)throw new Error("L.Control.Button: failed to initialize, label must either be text or a dom element");c=L.DomUtil.create("button",this.options.className),c.innerHTML=a}return L.DomUtil.addClass(c,this.options.position),this._container=c,this},isToggled:function(){return L.DomUtil.hasClass(this._container,this.options.toggleButton)},_fireClick:function(a){this.fire("click"),this.options.toggleButton&&(this._container,this.isToggled()?L.DomUtil.removeClass(this._container,this.options.toggleButton):L.DomUtil.addClass(this._container,this.options.toggleButton))},onAdd:function(a){if(this._container){L.DomEvent.on(this._container,"click",this._fireClick,this);var b=L.DomEvent.stopPropagation;L.DomEvent.on(this._container,"mousedown",b).on(this._container,"touchstart",b).on(this._container,"dblclick",b).on(this._container,"mousewheel",b).on(this._container,"MozMozMousePixelScroll",b),this.fire("load"),this._map=a}return this._container},onRemove:function(a){return this._container&&this._map&&(L.DomEvent.off(this._container,"click",this._fireClick,this),L.DomEvent.off(this._container,"mousedown",stop).off(this._container,"touchstart",stop).off(this._container,"dblclick",stop).off(this._container,"mousewheel",stop).off(this._container,"MozMozMousePixelScroll",stop),this.fire("unload"),this._map=null),this}}),L.control.button=function(a,b){return new L.Control.Button(a,b)},function(a,b){"function"==typeof define&&define.amd?define(["leaflet"],a):"object"==typeof exports&&(module.exports=a(require("leaflet"))),"undefined"!=typeof b&&b.L&&(b.L.Control.MiniMap=a(L),b.L.control.minimap=function(a,c){return new b.L.Control.MiniMap(a,c)})}(function(a){var b=a.Control.extend({options:{position:"bottomright",toggleDisplay:!1,zoomLevelOffset:-5,zoomLevelFixed:!1,centerFixed:!1,zoomAnimation:!1,autoToggleDisplay:!1,minimized:!1,width:150,height:150,collapsedWidth:19,collapsedHeight:19,aimingRectOptions:{color:"#ff7800",weight:1,clickable:!1},shadowRectOptions:{color:"#000000",weight:1,clickable:!1,opacity:0,fillOpacity:0},strings:{hideText:"Hide MiniMap",showText:"Show MiniMap"},mapOptions:{}},initialize:function(b,c){a.Util.setOptions(this,c),this.options.aimingRectOptions.clickable=!1,this.options.shadowRectOptions.clickable=!1,this._layer=b},onAdd:function(b){this._mainMap=b,this._container=a.DomUtil.create("div","leaflet-control-minimap"),this._container.style.width=this.options.width+"px",this._container.style.height=this.options.height+"px",a.DomEvent.disableClickPropagation(this._container),a.DomEvent.on(this._container,"mousewheel",a.DomEvent.stopPropagation);var c={attributionControl:!1,dragging:!this.options.centerFixed,zoomControl:!1,zoomAnimation:this.options.zoomAnimation,autoToggleDisplay:this.options.autoToggleDisplay,touchZoom:this.options.centerFixed?"center":!this._isZoomLevelFixed(),scrollWheelZoom:this.options.centerFixed?"center":!this._isZoomLevelFixed(),doubleClickZoom:this.options.centerFixed?"center":!this._isZoomLevelFixed(),boxZoom:!this._isZoomLevelFixed(),crs:b.options.crs};return c=a.Util.extend(this.options.mapOptions,c),this._miniMap=new a.Map(this._container,c),this._miniMap.addLayer(this._layer),this._mainMapMoving=!1,this._miniMapMoving=!1,this._userToggledDisplay=!1,this._minimized=!1,this.options.toggleDisplay&&this._addToggleButton(),this._miniMap.whenReady(a.Util.bind(function(){this._aimingRect=a.rectangle(this._mainMap.getBounds(),this.options.aimingRectOptions).addTo(this._miniMap),this._shadowRect=a.rectangle(this._mainMap.getBounds(),this.options.shadowRectOptions).addTo(this._miniMap),this._mainMap.on("moveend",this._onMainMapMoved,this),this._mainMap.on("move",this._onMainMapMoving,this),this._miniMap.on("movestart",this._onMiniMapMoveStarted,this),this._miniMap.on("move",this._onMiniMapMoving,this),this._miniMap.on("moveend",this._onMiniMapMoved,this)},this)),this._container},addTo:function(b){a.Control.prototype.addTo.call(this,b);var c=this.options.centerFixed||this._mainMap.getCenter();return this._miniMap.setView(c,this._decideZoom(!0)),this._setDisplay(this.options.minimized),this},onRemove:function(a){this._mainMap.off("moveend",this._onMainMapMoved,this),this._mainMap.off("move",this._onMainMapMoving,this),this._miniMap.off("moveend",this._onMiniMapMoved,this),this._miniMap.removeLayer(this._layer)},changeLayer:function(a){this._miniMap.removeLayer(this._layer),this._layer=a,this._miniMap.addLayer(this._layer)},_addToggleButton:function(){this._toggleDisplayButton=this.options.toggleDisplay?this._createButton("",this._toggleButtonInitialTitleText(),"leaflet-control-minimap-toggle-display leaflet-control-minimap-toggle-display-"+this.options.position,this._container,this._toggleDisplayButtonClicked,this):void 0,this._toggleDisplayButton.style.width=this.options.collapsedWidth+"px",this._toggleDisplayButton.style.height=this.options.collapsedHeight+"px"},_toggleButtonInitialTitleText:function(){return this.options.minimized?this.options.strings.showText:this.options.strings.hideText},_createButton:function(b,c,d,e,f,g){var h=a.DomUtil.create("a",d,e);h.innerHTML=b,h.href="#",h.title=c;var i=a.DomEvent.stopPropagation;return a.DomEvent.on(h,"click",i).on(h,"mousedown",i).on(h,"dblclick",i).on(h,"click",a.DomEvent.preventDefault).on(h,"click",f,g),h},_toggleDisplayButtonClicked:function(){this._userToggledDisplay=!0,this._minimized?this._restore():this._minimize()},_setDisplay:function(a){a!==this._minimized&&(this._minimized?this._restore():this._minimize())},_minimize:function(){this.options.toggleDisplay?(this._container.style.width=this.options.collapsedWidth+"px",this._container.style.height=this.options.collapsedHeight+"px",this._toggleDisplayButton.className+=" minimized-"+this.options.position,this._toggleDisplayButton.title=this.options.strings.showText):this._container.style.display="none",this._minimized=!0},_restore:function(){this.options.toggleDisplay?(this._container.style.width=this.options.width+"px",this._container.style.height=this.options.height+"px",this._toggleDisplayButton.className=this._toggleDisplayButton.className.replace("minimized-"+this.options.position,""),this._toggleDisplayButton.title=this.options.strings.hideText):this._container.style.display="block",this._minimized=!1},_onMainMapMoved:function(a){if(this._miniMapMoving)this._miniMapMoving=!1;else{var b=this.options.centerFixed||this._mainMap.getCenter();this._mainMapMoving=!0,this._miniMap.setView(b,this._decideZoom(!0)),this._setDisplay(this._decideMinimized())}this._aimingRect.setBounds(this._mainMap.getBounds())},_onMainMapMoving:function(a){this._aimingRect.setBounds(this._mainMap.getBounds())},_onMiniMapMoveStarted:function(a){if(!this.options.centerFixed){var b=this._aimingRect.getBounds(),c=this._miniMap.latLngToContainerPoint(b.getSouthWest()),d=this._miniMap.latLngToContainerPoint(b.getNorthEast());this._lastAimingRectPosition={sw:c,ne:d}}},_onMiniMapMoving:function(b){this.options.centerFixed||!this._mainMapMoving&&this._lastAimingRectPosition&&(this._shadowRect.setBounds(new a.LatLngBounds(this._miniMap.containerPointToLatLng(this._lastAimingRectPosition.sw),this._miniMap.containerPointToLatLng(this._lastAimingRectPosition.ne))),this._shadowRect.setStyle({opacity:1,fillOpacity:.3}))},_onMiniMapMoved:function(a){this._mainMapMoving?this._mainMapMoving=!1:(this._miniMapMoving=!0,this._mainMap.setView(this._miniMap.getCenter(),this._decideZoom(!1)),this._shadowRect.setStyle({opacity:0,fillOpacity:0}))},_isZoomLevelFixed:function(){var a=this.options.zoomLevelFixed;return this._isDefined(a)&&this._isInteger(a)},_decideZoom:function(a){if(this._isZoomLevelFixed())return a?this.options.zoomLevelFixed:this._mainMap.getZoom();if(a)return this._mainMap.getZoom()+this.options.zoomLevelOffset;var b,c=this._miniMap.getZoom()-this._mainMap.getZoom(),d=this._miniMap.getZoom()-this.options.zoomLevelOffset;return c>this.options.zoomLevelOffset&&this._mainMap.getZoom()<this._miniMap.getMinZoom()-this.options.zoomLevelOffset?this._miniMap.getZoom()>this._lastMiniMapZoom?(b=this._mainMap.getZoom()+1,this._miniMap.setZoom(this._miniMap.getZoom()-1)):b=this._mainMap.getZoom():b=d,this._lastMiniMapZoom=this._miniMap.getZoom(),b},_decideMinimized:function(){return this._userToggledDisplay?this._minimized:this.options.autoToggleDisplay?!!this._mainMap.getBounds().contains(this._miniMap.getBounds()):this._minimized},_isInteger:function(a){return"number"==typeof a},_isDefined:function(a){return"undefined"!=typeof a}});return a.Map.mergeOptions({miniMapControl:!1}),a.Map.addInitHook(function(){this.options.miniMapControl&&(this.miniMapControl=(new b).addTo(this))}),b},window),function(a){var b;if("function"==typeof define&&define.amd)define(["leaflet"],a);else if("object"==typeof module&&"object"==typeof module.exports)b=require("leaflet"),module.exports=a(b);else{if("undefined"==typeof window.L)throw new Error("Leaflet must be loaded first");a(window.L)}}(function(a){a.Map.mergeOptions({contextmenuItems:[]}),a.Map.ContextMenu=a.Handler.extend({_touchstart:a.Browser.msPointer?"MSPointerDown":a.Browser.pointer?"pointerdown":"touchstart",statics:{BASE_CLS:"leaflet-contextmenu"},initialize:function(b){a.Handler.prototype.initialize.call(this,b),this._items=[],this._visible=!1;var c=this._container=a.DomUtil.create("div",a.Map.ContextMenu.BASE_CLS,b._container);c.style.zIndex=1e4,c.style.position="absolute",b.options.contextmenuWidth&&(c.style.width=b.options.contextmenuWidth+"px"),this._createItems(),a.DomEvent.on(c,"click",a.DomEvent.stop).on(c,"mousedown",a.DomEvent.stop).on(c,"dblclick",a.DomEvent.stop).on(c,"contextmenu",a.DomEvent.stop)},addHooks:function(){var b=this._map.getContainer();a.DomEvent.on(b,"mouseleave",this._hide,this).on(document,"keydown",this._onKeyDown,this),a.Browser.touch&&a.DomEvent.on(document,this._touchstart,this._hide,this),this._map.on({contextmenu:this._show,mousedown:this._hide,movestart:this._hide,zoomstart:this._hide},this)},removeHooks:function(){var b=this._map.getContainer();a.DomEvent.off(b,"mouseleave",this._hide,this).off(document,"keydown",this._onKeyDown,this),a.Browser.touch&&a.DomEvent.off(document,this._touchstart,this._hide,this),this._map.off({contextmenu:this._show,mousedown:this._hide,movestart:this._hide,zoomstart:this._hide},this)},showAt:function(b,c){b instanceof a.LatLng&&(b=this._map.latLngToContainerPoint(b)),this._showAtPoint(b,c)},hide:function(){this._hide()},addItem:function(a){return this.insertItem(a)},insertItem:function(a,b){b=void 0!==b?b:this._items.length;var c=this._createItem(this._container,a,b);return this._items.push(c),this._sizeChanged=!0,this._map.fire("contextmenu.additem",{contextmenu:this,el:c.el,index:b}),c.el},removeItem:function(b){var c=this._container;return isNaN(b)||(b=c.children[b]),b?(this._removeItem(a.Util.stamp(b)),this._sizeChanged=!0,this._map.fire("contextmenu.removeitem",{contextmenu:this,el:b}),b):null},removeAllItems:function(){for(var b,c=this._container.children;c.length;)b=c[0],this._removeItem(a.Util.stamp(b));return c},hideAllItems:function(){var a,b,c;for(b=0,c=this._items.length;c>b;b++)a=this._items[b],a.el.style.display="none"},showAllItems:function(){var a,b,c;for(b=0,c=this._items.length;c>b;b++)a=this._items[b],a.el.style.display=""},setDisabled:function(b,c){var d=this._container,e=a.Map.ContextMenu.BASE_CLS+"-item";isNaN(b)||(b=d.children[b]),b&&a.DomUtil.hasClass(b,e)&&(c?(a.DomUtil.addClass(b,e+"-disabled"),this._map.fire("contextmenu.disableitem",{contextmenu:this,el:b})):(a.DomUtil.removeClass(b,e+"-disabled"),this._map.fire("contextmenu.enableitem",{contextmenu:this,el:b})))},isVisible:function(){return this._visible},_createItems:function(){var a,b,c=this._map.options.contextmenuItems;for(a=0,b=c.length;b>a;a++)this._items.push(this._createItem(this._container,c[a]))},_createItem:function(b,c,d){if(c.separator||"-"===c)return this._createSeparator(b,d);var e=a.Map.ContextMenu.BASE_CLS+"-item",f=c.disabled?e+" "+e+"-disabled":e,g=this._insertElementAt("a",f,b,d),h=this._createEventHandler(g,c.callback,c.context,c.hideOnSelect),i=this._getIcon(c),j=this._getIconCls(c),k="";return i?k='<img class="'+a.Map.ContextMenu.BASE_CLS+'-icon" src="'+i+'"/>':j&&(k='<span class="'+a.Map.ContextMenu.BASE_CLS+"-icon "+j+'"></span>'),g.innerHTML=k+c.text,g.href="#",a.DomEvent.on(g,"mouseover",this._onItemMouseOver,this).on(g,"mouseout",this._onItemMouseOut,this).on(g,"mousedown",a.DomEvent.stopPropagation).on(g,"click",h),a.Browser.touch&&a.DomEvent.on(g,this._touchstart,a.DomEvent.stopPropagation),a.Browser.pointer||a.DomEvent.on(g,"click",this._onItemMouseOut,this),{id:a.Util.stamp(g),el:g,callback:h}},_removeItem:function(b){var c,d,e,f,g;for(e=0,f=this._items.length;f>e;e++)if(c=this._items[e],c.id===b)return d=c.el,g=c.callback,g&&(a.DomEvent.off(d,"mouseover",this._onItemMouseOver,this).off(d,"mouseover",this._onItemMouseOut,this).off(d,"mousedown",a.DomEvent.stopPropagation).off(d,"click",g),a.Browser.touch&&a.DomEvent.off(d,this._touchstart,a.DomEvent.stopPropagation),a.Browser.pointer||a.DomEvent.on(d,"click",this._onItemMouseOut,this)),this._container.removeChild(d),this._items.splice(e,1),c;return null},_createSeparator:function(b,c){var d=this._insertElementAt("div",a.Map.ContextMenu.BASE_CLS+"-separator",b,c);return{id:a.Util.stamp(d),el:d}},_createEventHandler:function(b,c,d,e){var f=this,g=this._map,h=a.Map.ContextMenu.BASE_CLS+"-item-disabled",e=void 0===e||e;return function(i){a.DomUtil.hasClass(b,h)||(e&&f._hide(),c&&c.call(d||g,f._showLocation),f._map.fire("contextmenu.select",{contextmenu:f,el:b}))}},_insertElementAt:function(a,b,c,d){var e,f=document.createElement(a);return f.className=b,void 0!==d&&(e=c.children[d]),e?c.insertBefore(f,e):c.appendChild(f),f},_show:function(a){this._showAtPoint(a.containerPoint,a)},_showAtPoint:function(b,c){if(this._items.length){var d=this._map,e=d.containerPointToLayerPoint(b),f=d.layerPointToLatLng(e),g=a.extend(c||{},{contextmenu:this});this._showLocation={latlng:f,layerPoint:e,containerPoint:b},c&&c.relatedTarget&&(this._showLocation.relatedTarget=c.relatedTarget),this._setPosition(b),this._visible||(this._container.style.display="block",this._visible=!0),this._map.fire("contextmenu.show",g)}},_hide:function(){this._visible&&(this._visible=!1,this._container.style.display="none",this._map.fire("contextmenu.hide",{contextmenu:this}))},_getIcon:function(b){return a.Browser.retina&&b.retinaIcon||b.icon},_getIconCls:function(b){return a.Browser.retina&&b.retinaIconCls||b.iconCls},_setPosition:function(b){var c,d=this._map.getSize(),e=this._container,f=this._getElementSize(e);this._map.options.contextmenuAnchor&&(c=a.point(this._map.options.contextmenuAnchor),b=b.add(c)),e._leaflet_pos=b,b.x+f.x>d.x?(e.style.left="auto",e.style.right=Math.min(Math.max(d.x-b.x,0),d.x-f.x-1)+"px"):(e.style.left=Math.max(b.x,0)+"px",e.style.right="auto"),b.y+f.y>d.y?(e.style.top="auto",e.style.bottom=Math.min(Math.max(d.y-b.y,0),d.y-f.y-1)+"px"):(e.style.top=Math.max(b.y,0)+"px",e.style.bottom="auto")},_getElementSize:function(a){var b=this._size,c=a.style.display;return(!b||this._sizeChanged)&&(b={},a.style.left="-999999px",a.style.right="auto",a.style.display="block",b.x=a.offsetWidth,b.y=a.offsetHeight,a.style.left="auto",a.style.display=c,this._sizeChanged=!1),b},_onKeyDown:function(a){var b=a.keyCode;27===b&&this._hide()},_onItemMouseOver:function(b){a.DomUtil.addClass(b.target||b.srcElement,"over")},_onItemMouseOut:function(b){a.DomUtil.removeClass(b.target||b.srcElement,"over")}}),a.Map.addInitHook("addHandler","contextmenu",a.Map.ContextMenu),a.Mixin.ContextMenu={bindContextMenu:function(b){return a.setOptions(this,b),this._initContextMenu(),this},unbindContextMenu:function(){return this.off("contextmenu",this._showContextMenu,this),this},addContextMenuItem:function(a){this.options.contextmenuItems.push(a)},removeContextMenuItemWithIndex:function(a){for(var b=[],c=0;c<this.options.contextmenuItems.length;c++)this.options.contextmenuItems[c].index==a&&b.push(c);for(var d=b.pop();void 0!==d;)this.options.contextmenuItems.splice(d,1),d=b.pop()},replaceContextMenuItem:function(a){this.removeContextMenuItemWithIndex(a.index),this.addContextMenuItem(a)},_initContextMenu:function(){this._items=[],this.on("contextmenu",this._showContextMenu,this)},_showContextMenu:function(b){var c,d,e,f,g;if(this._map.contextmenu){for(d=a.extend({relatedTarget:this},b),e=this._map.mouseEventToContainerPoint(b.originalEvent),this.options.contextmenuInheritItems||this._map.contextmenu.hideAllItems(),f=0,g=this.options.contextmenuItems.length;g>f;f++)c=this.options.contextmenuItems[f],this._items.push(this._map.contextmenu.insertItem(c,c.index));this._map.once("contextmenu.hide",this._hideContextMenu,this),this._map.contextmenu.showAt(e,d)}},_hideContextMenu:function(){var a,b;for(a=0,b=this._items.length;b>a;a++)this._map.contextmenu.removeItem(this._items[a]);this._items.length=0,this.options.contextmenuInheritItems||this._map.contextmenu.showAllItems()}};var b,c,d,e=[a.Marker,a.Path],f={contextmenu:!1,contextmenuItems:[],contextmenuInheritItems:!0};for(c=0,d=e.length;d>c;c++)b=e[c],b.prototype.options?b.mergeOptions(f):b.prototype.options=f,b.addInitHook(function(){this.options.contextmenu&&this._initContextMenu()}),b.include(a.Mixin.ContextMenu);return a.Map.ContextMenu});